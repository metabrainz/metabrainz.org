{% extends 'admin/master.html' %}
{% block body %}
  <div class="page-title">
    <i class="fa fa-money"></i> Payments & Donations
  </div>
  <p class="page-subtitle">View and manage all payments and donations, sorted by date</p>

  <div class="admin-card" style="margin-bottom: 25px;">
    <div class="btn-group" role="group" aria-label="Payment filter">
      <a href="{{ url_for('paymentsview.list') }}"
         class="btn {{ 'btn-primary' if is_donation is none else 'btn-secondary' }}"
         style="{% if is_donation is not none %}background-color: #e2e8f0 !important; color: #4a5568 !important; border: 1px solid #cbd5e0 !important;{% endif %}">
        <i class="fa fa-list"></i> All
      </a>
      <a href="{{ url_for('paymentsview.list', is_donation=False) }}"
         class="btn {{ 'btn-primary' if is_donation == False else 'btn-secondary' }}"
         style="{% if is_donation != False %}background-color: #e2e8f0 !important; color: #4a5568 !important; border: 1px solid #cbd5e0 !important;{% endif %}">
        <i class="fa fa-credit-card"></i> Payments Only
      </a>
      <a href="{{ url_for('paymentsview.list', is_donation=True) }}"
         class="btn {{ 'btn-primary' if is_donation == True else 'btn-secondary' }}"
         style="{% if is_donation != True %}background-color: #e2e8f0 !important; color: #4a5568 !important; border: 1px solid #cbd5e0 !important;{% endif %}">
        <i class="fa fa-heart"></i> Donations Only
      </a>
    </div>
  </div>

  <div class="admin-card">
    {% if payments %}
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Actions</th>
              <th title="Internal payment identifier">ID</th>
              <th>Payer</th>
              <th>Amount</th>
              <th>Date</th>
              <th>Type</th>
            </tr>
          </thead>
          <tbody>
            {% for payment in payments %}
              <tr>
                <td>
                  <a href="{{ url_for('payment_model.details_view', id=payment.id) }}"
                     class="btn btn-secondary btn-sm" role="button" title="Details">
                    <i class="fa fa-eye"></i>
                  </a>
                  <a href="{{ url_for('payment_model.edit_view', id=payment.id) }}"
                     class="btn btn-primary btn-sm" role="button" title="Edit">
                    <i class="fa fa-edit"></i>
                  </a>
                </td>
                <td><code>{{ payment.id }}</code></td>
                <td><strong>{{ payment.first_name }} {{ payment.last_name }}</strong></td>
                <td>{{ payment.amount }} {{ payment.currency|upper }}</td>
                <td>{{ payment.payment_date|datetime }}</td>
                <td>
                  {% if payment.is_donation %}
                    <span class="badge bg-success"><i class="fa fa-heart"></i> Donation</span>
                  {% else %}
                    <span class="badge badge-orange"><i class="fa fa-credit-card"></i> Payment</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if count > limit %}
        <div style="margin-top: 20px; text-align: center;">
          <div class="btn-group" role="group">
            {% if page > 1 %}
              <a href="{{ url_for('paymentsview.list', page=page-1, is_donation=is_donation) }}"
                 class="btn btn-primary">
                <i class="fa fa-arrow-left"></i> Previous
              </a>
            {% endif %}
            <span class="btn btn-secondary" style="background-color: #f7fafc !important; color: #4a5568 !important; border: 1px solid #cbd5e0 !important; cursor: default;">
              Page {{ page }} of {{ (count // limit) + 1 }}
            </span>
            {% if page-1 < count//limit %}
              <a href="{{ url_for('paymentsview.list', page=page+1, is_donation=is_donation) }}"
                 class="btn btn-primary">
                Next <i class="fa fa-arrow-right"></i>
              </a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    {% else %}
      <div class="empty-state">
        <i class="fa fa-inbox" style="font-size: 48px; margin-bottom: 15px;"></i>
        <p>No
          {% if is_donation == True %}
            donations
          {% elif is_donation == False %}
            payments
          {% else %}
            payments or donations
          {% endif %}
          found.
        </p>
      </div>
    {% endif %}
  </div>
{% endblock %}
